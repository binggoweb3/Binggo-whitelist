<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>BINGGO Whitelist</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
body {
  background: radial-gradient(circle at top, #020617, #000);
}
.glow {
  box-shadow: 0 0 25px rgba(59,130,246,.6);
}
</style>
</head>

<body class="text-white min-h-screen">

<!-- HEADER -->
<header class="flex justify-between items-center px-6 py-5 border-b border-white/10">
  <div class="flex items-center gap-3">
    <img src="logo.png" class="w-9 h-9" alt="BINGGO">
    <span class="font-bold text-lg">BINGGO Web3</span>
  </div>
  <span class="text-sm text-blue-400">Solana Network</span>
</header>

<main class="max-w-5xl mx-auto px-6 py-12 grid md:grid-cols-2 gap-12">

<!-- LEFT -->
<div>

<h1 class="text-4xl font-extrabold mb-4">Whitelist Registration</h1>
<p class="text-blue-300 mb-8">Complete missions & secure early access</p>

<!-- MISSIONS -->
<div class="space-y-4 mb-10">
  <h2 class="text-lg font-semibold">Complete Missions</h2>

  <button data-mission onclick="completeMission(this,'https://x.com/Binggoweb3')"
    class="w-full flex justify-between items-center px-4 py-3 rounded-xl bg-white/5 border border-white/10">
    <span>Follow X (@Binggoweb3)</span>
    <span class="text-xs text-blue-400">Open</span>
  </button>

  <button data-mission onclick="completeMission(this,'https://t.me/Binggoweb3')"
    class="w-full flex justify-between items-center px-4 py-3 rounded-xl bg-white/5 border border-white/10">
    <span>Join Telegram</span>
    <span class="text-xs text-blue-400">Open</span>
  </button>

  <button data-mission onclick="completeMission(this,'https://discord.gg/Sbxy3EyRT')"
    class="w-full flex justify-between items-center px-4 py-3 rounded-xl bg-white/5 border border-white/10">
    <span>Join Discord</span>
    <span class="text-xs text-blue-400">Open</span>
  </button>
</div>

<!-- FORM -->
<form id="form" class="space-y-4 bg-white/5 border border-white/10 rounded-2xl p-6">
  <input id="wallet" required placeholder="Solana Wallet Address"
    class="w-full px-4 py-3 rounded-lg bg-black/40 border border-white/10" />

  <input id="twitter" required placeholder="X Username"
    class="w-full px-4 py-3 rounded-lg bg-black/40 border border-white/10" />

  <input id="refCodeInput" placeholder="Referral Code (optional)"
    class="w-full px-4 py-3 rounded-lg bg-black/40 border border-white/10" />

  <button id="submitBtn" disabled
    class="w-full py-3 bg-blue-600/40 rounded-lg font-semibold cursor-not-allowed">
    Complete Missions First
  </button>
</form>

<div id="success" class="hidden mt-6 bg-white/5 border border-white/10 rounded-xl p-4">
  <p class="text-green-400 font-semibold">Whitelist Success</p>
  <p class="text-sm mt-2">Your Referral Code</p>
  <div id="myCode" class="text-xl font-bold text-blue-400 mt-1"></div>
</div>

<p id="error" class="hidden text-red-400 text-sm mt-4"></p>

</div>

<!-- RIGHT -->
<div>

<h2 class="text-2xl font-bold mb-4">Top 10 Referrals</h2>

<div class="bg-white/5 border border-white/10 rounded-2xl overflow-hidden">
<table class="w-full text-sm">
<thead class="bg-white/10">
<tr>
  <th class="px-4 py-3 text-left">#</th>
  <th class="px-4 py-3 text-left">Referral Code</th>
  <th class="px-4 py-3 text-right">Invites</th>
</tr>
</thead>
<tbody id="leaderboard" class="divide-y divide-white/10"></tbody>
</table>
</div>

</div>
</main>

<footer class="text-center text-sm text-white/40 py-10">
Â© 2026 BINGGO Web3
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, doc, runTransaction,
  collection, query, where, getDocs,
  orderBy, limit, onSnapshot
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC9D_9HQ-IB65E3c2KKcH7tSOE1pAammvM",
  authDomain: "binggo---whitelist.firebaseapp.com",
  projectId: "binggo---whitelist",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const submitBtn = document.getElementById("submitBtn");
const leaderboard = document.getElementById("leaderboard");

let completed = new Set();

window.completeMission = (btn, url) => {
  window.open(url, "_blank");
  btn.classList.add("opacity-50","pointer-events-none");
  completed.add(btn);

  if (completed.size === document.querySelectorAll("[data-mission]").length) {
    submitBtn.disabled = false;
    submitBtn.textContent = "Submit Whitelist";
    submitBtn.classList.remove("bg-blue-600/40","cursor-not-allowed");
    submitBtn.classList.add("bg-blue-600","glow");
  }
};

function generateRefCode() {
  return "BINGGO-" + Math.random().toString(36).substring(2,7).toUpperCase();
}

// SUBMIT
form.addEventListener("submit", async e => {
  e.preventDefault();
  error.classList.add("hidden");

  const walletVal = wallet.value.trim();
  const twitterVal = twitter.value.trim();
  const inputCode = refCodeInput.value.trim();

  try {
    await runTransaction(db, async t => {
      const userRef = doc(db,"whitelist",walletVal);
      if ((await t.get(userRef)).exists()) throw "Wallet already registered";

      const myRefCode = generateRefCode();

      t.set(userRef,{
        refCode: myRefCode,
        twitter: twitterVal,
        refCount: 0,
        createdAt: Date.now()
      });

      if (inputCode) {
        const q = query(collection(db,"whitelist"),where("refCode","==",inputCode));
        (await getDocs(q)).forEach(d=>{
          t.update(d.ref,{refCount:(d.data().refCount||0)+1});
        });
      }

      myCode.textContent = myRefCode;
    });

    success.classList.remove("hidden");
    submitBtn.disabled = true;

  } catch(err) {
    error.textContent = err;
    error.classList.remove("hidden");
  }
});

// LEADERBOARD REALTIME
onSnapshot(
  query(collection(db,"whitelist"),orderBy("refCount","desc"),limit(10)),
  snap=>{
    leaderboard.innerHTML="";
    let i=1;
    snap.forEach(d=>{
      leaderboard.innerHTML+=`
        <tr>
          <td class="px-4 py-3">${i++}</td>
          <td class="px-4 py-3">${d.data().refCode}</td>
          <td class="px-4 py-3 text-right text-blue-400">${d.data().refCount}</td>
        </tr>`;
    });
  }
);
</script>

</body>
</html>